<!DOCTYPE html>
<html>
  <head>
    <title>Browse</title>
    <link rel='stylesheet', href='/stylesheets/style.css'>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script type="text/javascript">
      function browse() {
        $.post("/browse", {
          search: document.getElementById('search').value,
          category: document.getElementById('category').value,
          page: document.getElementById('page').value
        },
        (data, status) => {
          console.log(data);
        });
      }
    </script>
  </head>
  <body>
    <h1>Browse</h1>
    <form name="form" action="" onsubmit="browse();return false">
        <input id='search' type='text' placeholder='Search' name='search'><br>
        <select id='category' name='category'>
          <option value="all">All</option>
          <option value="document">Document</option>
          <option value="image">Image</option>
          <option value="video">Video</option>
          <option value="audio">Audio</option>
        </select><br>
        Page: <input id='page' type='number' name='page' placeholder='1' maxlength="3" size="3"><br>
        <input type='submit' value='Submit'><br>
    </form>
    <table width="100%">
      <tr>
        <th>Author</th>
        <th>Title</th>
        <th>Description</th>
        <th>Category</th>
        <th>Preview Image</th>
        <th>Price</th>
        <th>Controls</th>
      </tr>
      <% results.forEach(function(obj){ %>
      <tr>
        <td style="text-align:center">
          <img src="./<%=obj.author_profile_path%>" style="width: 50px; height: 50px;"> 
          <%=obj.author_username%>
        </td>
        <td style="text-align:center"><%=obj.title%></td>
        <td style="text-align:center"><%=obj.description%></td>
        <td style="text-align:center"><%=obj.category%></td>
        <td style="text-align:center">
           <img src="./<%=obj.preview_path%>" style="width: 100px; height: 100px;"> 
        </td>
        <td style="text-align:center">$<%=obj.price%></td>
        <% if(obj.bought == 'false') { %>
        <td style="text-align:center">
          <form action="/cart" method="post" style="display: inline-block;">
            <button type="submit" name="m_id" value="<%=obj.m_id%>" style="background-color: #4CAF50;">Add to Cart</button>
          </form>
          <form action="/message" method="get" style="display: inline-block;">
            <button type="submit" name="acc_id" value="<%=obj.acc_id%>" style="background-color: #4CAF50;">Message</button>
          </form>
        </td>
        <% } else { %>
        <td style="text-align:center">
          <form action="/download" method="post" style="display: inline-block;">
            <button type="submit" name="path" value="<%=obj.raw_path%>">Download</button>
          </form>
        </td>
        <% } %>
      </tr>
      <%})%>
    </table>
  </body>
</html>